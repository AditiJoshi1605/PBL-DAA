<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard - Smart Bus System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="text-center">Student Dashboard</h2>

    <!-- Input Section -->
    <div class="card my-4 p-3">
        <form id="locationForm" class="row g-3">
            <div class="col-md-5">
                <label for="source" class="form-label">Your Location</label>
                <input type="text" id="source" name="source" class="form-control" placeholder="Enter your location">
            </div>
            <div class="col-md-4">
                <label for="predictBtn" class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">Find Nearest Stop</button>
            </div>
        </form>
    </div>

    <!-- Nearest Stop Info -->
    <div id="nearestStop" class="alert alert-info d-none"></div>

    <!-- Map Section -->
    <div id="map" class="my-4 rounded shadow" style="height: 500px;"></div>
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([30.3165, 78.0322], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data Â© OpenStreetMap contributors'
    }).addTo(map);

    document.getElementById('locationForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const source = document.getElementById('source').value;

        // Call backend to get nearest stop and route data
        const response = await fetch('/api/nearest_stop?location=' + encodeURIComponent(source));
        const data = await response.json();

        const infoDiv = document.getElementById('nearestStop');
        infoDiv.classList.remove('d-none');
        infoDiv.innerHTML = `
            <strong>Nearest Stop:</strong> ${data.stop} <br>
            <strong>Distance:</strong> ${data.distance_km.toFixed(2)} km
        `;

        // Add marker to map
        const marker = L.marker([data.lat, data.lng]).addTo(map);
        marker.bindPopup(`<b>Nearest Stop</b><br>${data.stop}`).openPopup();
        map.setView([data.lat, data.lng], 15);
    });

    document.addEventListener("mousemove", (e) => {
        const moveX = (e.clientX / window.innerWidth - 0.5) * 10;
        const moveY = (e.clientY / window.innerHeight - 0.5) * 10;
        document.body.style.transform = `translate(${moveX}px, ${moveY}px)`;
    });
</script>


</body>
</html>
